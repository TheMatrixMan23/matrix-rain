<!DOCTYPE html>
<html>
<head>
<title>Audio Visualizer</title>
<style>
body {
  background-color: black;
  margin: 0;
  overflow: hidden;
  color: white;
}

#canvas {
  display: block;
}

#controls {
  position: absolute;
  top: 10px;
  left: 10px;
  z-index: 10;
}

input[type="range"] {
  width: 200px;
}

label {
    display: block;
    margin-bottom: 5px;
}
</style>
</head>
<body>

<canvas id="canvas"></canvas>
<audio id="audio" controls style="display:none;"></audio>

<div id="controls">
    <label for="spikeThreshold">Spike Threshold Multiplier:</label>
    <input type="range" id="spikeThreshold" min="1.0" max="5.0" step="0.1" value="2.0">
    <span id="spikeThresholdValue">2.0</span>

    <label for="kickCooldown">Kick Cooldown (ms):</label>
    <input type="range" id="kickCooldown" min="50" max="500" step="10" value="150">
    <span id="kickCooldownValue">150</span>

    <label for="frequencyRange">Frequency Range (e.g., 20-50):</label>
    <input type="text" id="frequencyRange" value="20-50">
</div>

<script>
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
const audio = document.getElementById('audio');

canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

// *** THIS IS WHERE YOU PUT THE FILE PATH ***
const filePath = 'LL.m4a'; // Replace with your actual path!
audio.src = filePath;

audio.onerror = function() {
  alert("Error loading audio file. Please check the file path. Is the file in the same directory?");
};

audio.onloadeddata = function() {
  audio.play();
  draw();
};

// ... (Rest of the JavaScript code from previous responses goes here)

// Get slider elements
const spikeThresholdSlider = document.getElementById('spikeThreshold');
const kickCooldownSlider = document.getElementById('kickCooldown');
const frequencyRangeInput = document.getElementById('frequencyRange');

// Get display elements for values
const spikeThresholdValueDisplay = document.getElementById('spikeThresholdValue');
const kickCooldownValueDisplay = document.getElementById('kickCooldownValue');


let spikeThresholdMultiplier = parseFloat(spikeThresholdSlider.value); // Initialize
let kickCooldown = parseInt(kickCooldownSlider.value); // Initialize
let frequencyRange = frequencyRangeInput.value;

// Event listeners for sliders
spikeThresholdSlider.addEventListener('input', () => {
    spikeThresholdMultiplier = parseFloat(spikeThresholdSlider.value);
    spikeThresholdValueDisplay.textContent = spikeThresholdSlider.value;
});

kickCooldownSlider.addEventListener('input', () => {
    kickCooldown = parseInt(kickCooldownSlider.value);
    kickCooldownValueDisplay.textContent = kickCooldownSlider.value;
});

frequencyRangeInput.addEventListener('input', () => {
    frequencyRange = frequencyRangeInput.value;
});



function detectKick() {
  const currentTime = audio.currentTime * 1000;

  const [startFreq, endFreq] = frequencyRange.split('-').map(Number); // Parse frequency range
  let currentLowFrequencyValue = analyzeFrequencyRange(startFreq, endFreq);

  let spikeDetected = false;
  const averagePrevious = previousLowFrequencyValues.reduce((a, b) => a + b, 0) / previousLowFrequencyValues.length;
  if (currentLowFrequencyValue > averagePrevious * spikeThresholdMultiplier) {
      spikeDetected = true;
  }

  previousLowFrequencyValues.shift();
  previousLowFrequencyValues.push(currentLowFrequencyValue);

  if (spikeDetected && currentTime - lastKickTime > kickCooldown) {
    lastKickTime = currentTime;
    return true;
  }

  return false;
}

function analyzeFrequencyRange(startFreq, endFreq) {
    let sum = 0;
    const startIndex = Math.round(startFreq / audioCtx.sampleRate * analyser.fftSize);
    const endIndex = Math.round(endFreq / audioCtx.sampleRate * analyser.fftSize);
    for (let i = startIndex; i < endIndex; i++) {
        sum += dataArray[i];
    }
    return sum / (endIndex - startIndex);
}

function draw() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  analyser.getByteFrequencyData(dataArray);

  if (detectKick()) {
    drawCircle();
  }

  requestAnimationFrame(draw);
}

function drawCircle() {
  ctx.fillStyle = 'white';
  ctx.beginPath();
  ctx.arc(canvas.width / 2, canvas.height / 2, 50, 0, 2 * Math.PI);
  ctx.fill();
}


window.addEventListener('resize', () => {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
});

</script>

</body>
</html>
